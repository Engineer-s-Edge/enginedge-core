openapi: 3.0.3
info:
  title: EnginEdge Main Hexagon API
  description: |
    The EnginEdge Main Hexagon provides a unified API gateway for orchestrating AI/ML workloads across specialized worker nodes.

    ## Architecture Overview
    This service implements hexagonal architecture with clean separation between domain logic, application use cases, and infrastructure adapters.

    ## Worker Types
    - **LLM Worker** (Port 3001): Large Language Model interactions
    - **Agent Tool Worker** (Port 3002): External tool integration
    - **Data Processing Worker** (Port 3003): Document processing and vector operations
    - **Interview Worker** (Port 3004): Interview processing and assessment
    - **LaTeX Worker** (Port 3005): Mathematical document generation
    - **RNLE Worker** (Port 3006): Symbolic mathematics and computation

    ## Authentication
    All API requests require an `x-api-key` header with a valid API key.
  version: 1.0.0
  contact:
    name: EnginEdge Team
    email: team@enginedge.com

servers:
  - url: http://localhost:3000
    description: Local development server
  - url: https://api.enginedge.com
    description: Production server

security:
  - ApiKeyAuth: []

paths:
  /api/orchestrate:
    post:
      summary: Orchestrate a new request
      description: |
        Submit a new request for processing by routing it to the appropriate worker node.

        The system will:
        1. Validate the request and determine the target worker
        2. Route the request via Kafka messaging
        3. Return a request ID for status tracking
        4. Process asynchronously and publish results
      operationId: orchestrateRequest
      tags:
        - Orchestration
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrchestrateRequest'
            examples:
              llm-request:
                summary: LLM Text Generation
                value:
                  taskType: "EXECUTE_ASSISTANT"
                  payload:
                    prompt: "Explain quantum computing in simple terms"
                    model: "gpt-4"
                    maxTokens: 500
                  metadata:
                    priority: "normal"
                    userId: "user123"
              document-processing:
                summary: Document Processing
                value:
                  taskType: "PROCESS_DOCUMENT"
                  payload:
                    documentUrl: "https://example.com/document.pdf"
                    operations: ["extract_text", "generate_embeddings"]
                  metadata:
                    priority: "high"
                    userId: "user456"
              interview-scheduling:
                summary: Interview Scheduling
                value:
                  taskType: "SCHEDULE_INTERVIEW"
                  payload:
                    candidateId: "cand789"
                    interviewerId: "int321"
                    scheduledTime: "2024-01-15T14:00:00Z"
                  metadata:
                    priority: "urgent"
                    userId: "user789"
      responses:
        '202':
          description: Request accepted for processing
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrchestrateResponse'
              example:
                requestId: "req_1234567890abcdef"
                status: "accepted"
                estimatedDuration: 30
                workerType: "llm"
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Invalid task type"
                code: "INVALID_TASK_TYPE"
                timestamp: "2024-01-15T10:30:00Z"
        '401':
          description: Invalid or missing API key
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Invalid API key"
                code: "INVALID_API_KEY"
                timestamp: "2024-01-15T10:30:00Z"
        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Rate limit exceeded"
                code: "RATE_LIMIT_EXCEEDED"
                timestamp: "2024-01-15T10:30:00Z"
        '503':
          description: Service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "No eligible workers available"
                code: "NO_WORKERS_AVAILABLE"
                timestamp: "2024-01-15T10:30:00Z"

  /api/requests/{requestId}/status:
    get:
      summary: Get request status
      description: Retrieve the current status and results of a previously submitted request.
      operationId: getRequestStatus
      tags:
        - Orchestration
      parameters:
        - name: requestId
          in: path
          required: true
          description: The unique identifier of the request
          schema:
            type: string
            pattern: '^req_[a-f0-9]{16}$'
          example: "req_1234567890abcdef"
      responses:
        '200':
          description: Request status retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RequestStatusResponse'
              examples:
                pending:
                  summary: Request pending
                  value:
                    requestId: "req_1234567890abcdef"
                    status: "PENDING"
                    submittedAt: "2024-01-15T10:30:00Z"
                    estimatedCompletion: "2024-01-15T10:30:30Z"
                processing:
                  summary: Request being processed
                  value:
                    requestId: "req_1234567890abcdef"
                    status: "PROCESSING"
                    submittedAt: "2024-01-15T10:30:00Z"
                    startedAt: "2024-01-15T10:30:05Z"
                    workerId: "worker_llm_001"
                completed:
                  summary: Request completed successfully
                  value:
                    requestId: "req_1234567890abcdef"
                    status: "COMPLETED"
                    submittedAt: "2024-01-15T10:30:00Z"
                    startedAt: "2024-01-15T10:30:05Z"
                    completedAt: "2024-01-15T10:30:25Z"
                    result:
                      text: "Quantum computing uses quantum mechanics principles..."
                      usage:
                        promptTokens: 10
                        completionTokens: 150
                        totalTokens: 160
                    workerId: "worker_llm_001"
                failed:
                  summary: Request failed
                  value:
                    requestId: "req_1234567890abcdef"
                    status: "FAILED"
                    submittedAt: "2024-01-15T10:30:00Z"
                    startedAt: "2024-01-15T10:30:05Z"
                    failedAt: "2024-01-15T10:30:15Z"
                    error: "Model timeout"
                    workerId: "worker_llm_001"
        '404':
          description: Request not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Request not found"
                code: "REQUEST_NOT_FOUND"
                timestamp: "2024-01-15T10:30:00Z"
        '401':
          description: Invalid or missing API key
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/requests/{requestId}/cancel:
    post:
      summary: Cancel a request
      description: Cancel a pending or processing request if possible.
      operationId: cancelRequest
      tags:
        - Orchestration
      parameters:
        - name: requestId
          in: path
          required: true
          description: The unique identifier of the request
          schema:
            type: string
            pattern: '^req_[a-f0-9]{16}$'
      responses:
        '200':
          description: Request cancelled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  requestId:
                    type: string
                    example: "req_1234567890abcdef"
                  status:
                    type: string
                    enum: [CANCELLED]
                    example: "CANCELLED"
                  cancelledAt:
                    type: string
                    format: date-time
                    example: "2024-01-15T10:35:00Z"
        '400':
          description: Request cannot be cancelled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Request is already completed"
                code: "CANNOT_CANCEL_COMPLETED_REQUEST"
                timestamp: "2024-01-15T10:30:00Z"
        '404':
          description: Request not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/health:
    get:
      summary: Get system health status
      description: Retrieve the overall health status of the EnginEdge system and its components.
      operationId: getSystemHealth
      tags:
        - Health
      responses:
        '200':
          description: Health status retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'
              example:
                status: "healthy"
                timestamp: "2024-01-15T10:30:00Z"
                version: "1.0.0"
                uptime: 3600
                services:
                  kafka:
                    status: "healthy"
                    responseTime: 5
                  database:
                    status: "healthy"
                    responseTime: 12
                  redis:
                    status: "healthy"
                    responseTime: 3
                workers:
                  llm:
                    status: "healthy"
                    activeRequests: 2
                    lastHealthCheck: "2024-01-15T10:29:45Z"
                  agent_tool:
                    status: "healthy"
                    activeRequests: 0
                    lastHealthCheck: "2024-01-15T10:29:50Z"
                  data_processing:
                    status: "degraded"
                    activeRequests: 5
                    lastHealthCheck: "2024-01-15T10:29:40Z"
                    issues:
                      - "High memory usage"
        '503':
          description: System is unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'

  /api/workers:
    get:
      summary: Get worker status
      description: Retrieve the status and metrics of all worker nodes.
      operationId: getWorkerStatus
      tags:
        - Workers
      responses:
        '200':
          description: Worker status retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkerStatusResponse'
              example:
                workers:
                  - id: "worker_llm_001"
                    type: "llm"
                    status: "healthy"
                    endpoint: "http://assistant-worker-001:3001"
                    activeRequests: 2
                    totalRequests: 1250
                    averageResponseTime: 4500
                    lastHealthCheck: "2024-01-15T10:29:45Z"
                    capabilities:
                      - "text_generation"
                      - "prompt_engineering"
                      - "model_selection"
                  - id: "worker_agent_001"
                    type: "agent_tool"
                    status: "healthy"
                    endpoint: "http://agent-worker-001:3002"
                    activeRequests: 0
                    totalRequests: 890
                    averageResponseTime: 3200
                    lastHealthCheck: "2024-01-15T10:29:50Z"
                    capabilities:
                      - "api_integration"
                      - "script_execution"
                      - "data_transformation"

  /api/metrics:
    get:
      summary: Get system metrics
      description: Retrieve detailed performance metrics and statistics.
      operationId: getSystemMetrics
      tags:
        - Metrics
      responses:
        '200':
          description: Metrics retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemMetrics'
              example:
                requests:
                  total: 15432
                  successful: 15200
                  failed: 232
                  averageResponseTime: 4200
                  requestsPerMinute: 45
                workers:
                  totalActive: 6
                  totalCapacity: 24
                  averageUtilization: 0.75
                system:
                  memoryUsage: 0.68
                  cpuUsage: 0.45
                  activeConnections: 23
                  uptime: 86400

components:
  schemas:
    OrchestrateRequest:
      type: object
      required:
        - taskType
        - payload
      properties:
        taskType:
          type: string
          enum:
            - EXECUTE_ASSISTANT
            - PROCESS_DOCUMENT
            - SCHEDULE_INTERVIEW
            - GENERATE_LATEX
            - SOLVE_EQUATION
            - EXECUTE_TOOL
          description: The type of task to execute
          example: "EXECUTE_ASSISTANT"
        payload:
          type: object
          description: Task-specific payload data
          oneOf:
            - $ref: '#/components/schemas/LlmPayload'
            - $ref: '#/components/schemas/DocumentPayload'
            - $ref: '#/components/schemas/InterviewPayload'
            - $ref: '#/components/schemas/LatexPayload'
            - $ref: '#/components/schemas/EquationPayload'
            - $ref: '#/components/schemas/ToolPayload'
        metadata:
          type: object
          description: Optional metadata for request processing
          properties:
            priority:
              type: string
              enum: [low, normal, high, urgent]
              default: normal
            userId:
              type: string
              description: ID of the user making the request
            correlationId:
              type: string
              description: Correlation ID for request tracing
            timeout:
              type: integer
              description: Request timeout in seconds
              minimum: 1
              maximum: 3600

    LlmPayload:
      type: object
      required:
        - prompt
      properties:
        prompt:
          type: string
          description: The text prompt for the LLM
          example: "Explain quantum computing in simple terms"
        model:
          type: string
          enum: [gpt-4, gpt-3.5-turbo, claude-2]
          default: gpt-4
        maxTokens:
          type: integer
          minimum: 1
          maximum: 4000
          default: 1000
        temperature:
          type: number
          minimum: 0
          maximum: 2
          default: 0.7

    DocumentPayload:
      type: object
      required:
        - documentUrl
      properties:
        documentUrl:
          type: string
          format: uri
          description: URL of the document to process
        operations:
          type: array
          items:
            type: string
            enum: [extract_text, generate_embeddings, summarize, analyze]
          description: Operations to perform on the document
        chunkSize:
          type: integer
          description: Size of text chunks for processing
          default: 1000

    InterviewPayload:
      type: object
      required:
        - candidateId
        - interviewerId
        - scheduledTime
      properties:
        candidateId:
          type: string
        interviewerId:
          type: string
        scheduledTime:
          type: string
          format: date-time
        interviewType:
          type: string
          enum: [technical, behavioral, system_design]
          default: technical

    LatexPayload:
      type: object
      required:
        - content
      properties:
        content:
          type: string
          description: LaTeX content to compile
        template:
          type: string
          enum: [article, report, book]
          default: article
        outputFormat:
          type: string
          enum: [pdf, dvi, ps]
          default: pdf

    EquationPayload:
      type: object
      required:
        - equation
      properties:
        equation:
          type: string
          description: Mathematical equation to solve
          example: "x^2 + 2x + 1 = 0"
        operation:
          type: string
          enum: [solve, simplify, differentiate, integrate]
          default: solve

    ToolPayload:
      type: object
      required:
        - toolName
      properties:
        toolName:
          type: string
          description: Name of the tool to execute
        parameters:
          type: object
          description: Tool-specific parameters

    OrchestrateResponse:
      type: object
      required:
        - requestId
        - status
      properties:
        requestId:
          type: string
          pattern: '^req_[a-f0-9]{16}$'
          example: "req_1234567890abcdef"
        status:
          type: string
          enum: [accepted]
          example: "accepted"
        estimatedDuration:
          type: integer
          description: Estimated processing time in seconds
          example: 30
        workerType:
          type: string
          enum: [llm, agent_tool, data_processing, interview, latex, rnle]
          description: Type of worker assigned to handle the request

    RequestStatusResponse:
      type: object
      required:
        - requestId
        - status
        - submittedAt
      properties:
        requestId:
          type: string
          pattern: '^req_[a-f0-9]{16}$'
        status:
          type: string
          enum: [PENDING, PROCESSING, COMPLETED, FAILED, CANCELLED]
        submittedAt:
          type: string
          format: date-time
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
        failedAt:
          type: string
          format: date-time
        estimatedCompletion:
          type: string
          format: date-time
        result:
          type: object
          description: Task result (only present when status is COMPLETED)
        error:
          type: string
          description: Error message (only present when status is FAILED)
        workerId:
          type: string
          description: ID of the worker that processed the request

    HealthStatus:
      type: object
      required:
        - status
        - timestamp
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        timestamp:
          type: string
          format: date-time
        version:
          type: string
          example: "1.0.0"
        uptime:
          type: integer
          description: System uptime in seconds
        services:
          type: object
          description: Health status of external services
          additionalProperties:
            type: object
            properties:
              status:
                type: string
                enum: [healthy, unhealthy]
              responseTime:
                type: integer
                description: Response time in milliseconds
        workers:
          type: object
          description: Health status of worker nodes
          additionalProperties:
            type: object
            properties:
              status:
                type: string
                enum: [healthy, degraded, unhealthy]
              activeRequests:
                type: integer
              lastHealthCheck:
                type: string
                format: date-time
              issues:
                type: array
                items:
                  type: string

    WorkerStatusResponse:
      type: object
      required:
        - workers
      properties:
        workers:
          type: array
          items:
            type: object
            required:
              - id
              - type
              - status
              - endpoint
            properties:
              id:
                type: string
              type:
                type: string
                enum: [llm, agent_tool, data_processing, interview, latex, rnle]
              status:
                type: string
                enum: [healthy, degraded, unhealthy]
              endpoint:
                type: string
                format: uri
              activeRequests:
                type: integer
              totalRequests:
                type: integer
              averageResponseTime:
                type: integer
                description: Average response time in milliseconds
              lastHealthCheck:
                type: string
                format: date-time
              capabilities:
                type: array
                items:
                  type: string

    SystemMetrics:
      type: object
      required:
        - requests
        - workers
        - system
      properties:
        requests:
          type: object
          properties:
            total:
              type: integer
            successful:
              type: integer
            failed:
              type: integer
            averageResponseTime:
              type: integer
              description: Average response time in milliseconds
            requestsPerMinute:
              type: number
        workers:
          type: object
          properties:
            totalActive:
              type: integer
            totalCapacity:
              type: integer
            averageUtilization:
              type: number
              minimum: 0
              maximum: 1
        system:
          type: object
          properties:
            memoryUsage:
              type: number
              minimum: 0
              maximum: 1
            cpuUsage:
              type: number
              minimum: 0
              maximum: 1
            activeConnections:
              type: integer
            uptime:
              type: integer
              description: System uptime in seconds

    ErrorResponse:
      type: object
      required:
        - error
        - code
        - timestamp
      properties:
        error:
          type: string
          description: Human-readable error message
        code:
          type: string
          description: Machine-readable error code
          enum:
            - INVALID_TASK_TYPE
            - INVALID_API_KEY
            - RATE_LIMIT_EXCEEDED
            - NO_WORKERS_AVAILABLE
            - REQUEST_NOT_FOUND
            - CANNOT_CANCEL_COMPLETED_REQUEST
            - INVALID_REQUEST_PAYLOAD
            - WORKER_UNAVAILABLE
        timestamp:
          type: string
          format: date-time
        details:
          type: object
          description: Additional error details

  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key
      description: API key for authentication